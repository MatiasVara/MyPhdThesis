\section{Use of the Operators in a Surveillance Camera System}
In this section, we use the operators previously defined to coordinate the heterogeneous model of a surveillance camera system. To do so, we propose to use \bflow to specify how the operators are applied on the models that compose the surveillance camera system. In the following, we first present the \bflow specification, and then we use it to coordinate system. 

\subsection{\bflow Specification of the Surveillance Camera System}
To coordinate the surveillance camera system, we use \bflow to specify how the operators \emph{SyncFSMEventsAndSignals}, \emph{startActivityWhenEnter} and \emph{AtomicActivity} are applied between the models in Figure~\ref{fig:camerasystem}. To specify this, we define a \bflow specification named \emph{CameraSystem} (Listing~\ref{lst:bflowcamerasystem}: line 1) that begins by importing the \bcool specification (Listing~\ref{lst:bflowcamerasystem}: line 2), and then, it specifies the models to coordinate (Listing~\ref{lst:bflowcamerasystem}: line 3 to 6). The specification contains a \emph{Flow} that defines which operator is applied and on which models (see Listing~\ref{lst:bflowcamerasystem}). We describe how each operator is applied in turn. 

First, the operator SyncFSMEventsAndSignals is applied between the activity BatterySensor and the TFSM CameraEncoderControl (Listing~\ref{lst:bflowcamerasystem}: line 8). This results in the synchronization of the corresponding Signal and FSMEvent by relying on theirs names. Then, the operator startActivityWhenEnter is applied between the TFSM CameraEncoderControl and the activity doJPEG (Listing~\ref{lst:bflowcamerasystem}: line 9), and between the TFSM and the activity doJPEG2000 (Listing~\ref{lst:bflowcamerasystem}: line 10). This results in a synchronization between the entering and leaving of the states JPEGEncoder and  JPEG2000Encoder, and the execution of the activities doJPEG and doJPEG2000. Finally, to coordinate the time between the TFSM and the activities, the operator AtomicActivity must be applied between the TFSM CameraEncoderControl and each activity (Listing~\ref{lst:bflowcamerasystem}: line 11 and 12). This results in a synchronization between the local clock of the TFSM CameraEncoderControl and the execution of the activities. 


\begin{lstlisting}[language=bflow,
caption={\bflow specification for the Surveillance Camera System},
label={lst:bflowcamerasystem}, 
basicstyle=\scriptsize\ttfamily, backgroundcolor=\color{LGrey}, numbers=left, xleftmargin=2pt]
BCOoLFlow CameraSystem
ImportBCOoL  "TFSMAndActivity.bcool" ;
Model BatterySensor "batterysensor.ad"
Model CameraEncoderControl "cameraencodercontrol.tfsm"
Model doJPEG "doJPEG.ad"
Model doJPEG2000 "doJPEG2000.ad"
Flow 
	applies syncFSMEventsAndSignals between (BatterySensor, CameraEncoderControl);
	applies startActivityWhenEnter between (CameraEncoderControl, doJPEG);
	applies startActivityWhenEnter between (CameraEncoderControl, doJPEG2000);
	applies AtomicActivity between (CameraEncoderControl, doJPEG);		
	applies AtomicActivity between (CameraEncoderControl, doJPEG2000);		
end Flow;
\end{lstlisting}


In this subsection, we have presented the \bflow specification for the surveillance camera system. The \bflow specification defines how to build the coordination model for the camera system by relying on the operators previously defined. We want to highlight that these \bcool operators can be used to coordinate any set of TFSM and Activity models. In particular, in this subsection, we use these operators to coordinate the models of the camera. In the following subsection, we use this specification to execute the coordinated system.    

\subsection{Execution of the Surveillance Camera System}

In the modeling workbench, we use the \bflow specification to coordinate the surveillance camera system. The resulting model of coordination is composed of six \ccsl relations. Then, we use the modeling workbench to execute the coordinated system. Figure~\ref{fig:camerasystem} illustrates the partial timing output of the execution of the camera. As a result of the coordination, the \mse \emph{BatteryisHigh:occurs} and \emph{BatteryisHigh:executeIt} are strongly synchronized (in red in Figure~\ref{fig:camerasystem}). When the camera is in BatteryHigh state (in magenta in Figure~\ref{fig:camerasystem}), the activity doJPEG2000 is allowed to execute and the time in the TFSM does not elapse (in cyan in Figure~\ref{fig:camerasystem}). Only when the activity is finished, the time can elapse thus the \mse \emph{ms:ticks} is allowed to tick. 
\todo{Furthermore, by relying on \ccsl to express the coordination, we can provide execution and verification of the coordinated system. In coordination frameworks, these tasks are limited since they express the coordination in a GPL like Java in Ptolemy. }
		\begin{figure}[h]
			\center
			\includegraphics[width=1\columnwidth]{examples/figs/vcdcamera}
			\caption{Resulting timing output of the surveillance camera system}
			\label{fig:camerasystem}
		\end{figure}

%\todo{We want to highlighted that given the constrainst that we fixed and since all the states in the Camera are represented by activities, this makes the time not elapse at all. In the simulation, we only coordinated one of the activities, thus when the TFSM is in the other state the time is allowed to pass. The main drawback of this, is, since the activity as atomic, the time not elapse, this prevents the use of the timing transitions in the TFSM. In fact, there is non such a constrains, the time may elapse after the finishing of the activity and before the starting of it. However, this is hard to see that in the simulation, politic of the simulation?}

In this section, we have shown the use of \bflow to specify how the operators defined in the previous section are applied between the models of the camera. Then, we used this specification in the modeling workbench to execute the coordinated system. The reader can find the complete example in the companion website, which contains the models together with a detailed procedure to execute and verify the models. In addition, the site includes a video that shows the complete workflow by using the GEMOC studio. In the next section, we discuss about our approach by comparing it with coordination frameworks that propose a hard-coded hierarchical coordination.  
%the operator SyncProdut must be applied one time to coordinate the models â€¦ Then, the operators startActivityWhenEnter and AtomicActivity must be applied twice, one time for each activity. This specification is only for one camera which is composed by three models. However, this can be extended for N camera by modifying the bflow. 

	
	
	