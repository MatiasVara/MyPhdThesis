\subsection{Library}
\label{subsec:bcoollib}

\begin{figure}
	\center
	\includegraphics[width=.8\textwidth]{bcool/figs/moccmlmm}
	\caption{Excerpt of MoCCML Metamodel}
	\label{fig:moccml}
\end{figure}

Libraries are used to gather predefined event expressions and relations that can be imported by a \bcool specification (\emph{ImportedLibStatement} in Figure~\ref{fig:bcool}). \bcool relies on \moccml~\cite{moccmlbib} to define libraries of constraints between events. In this subsection, we present an overview of the notion of \moccml library.

A \moccml library (\emph{RelationLibrary} in Figure~\ref{fig:moccml}) is a set of declarations together with their formal parameters. It also contains some definitions, which give the actual behavior of the declarations. There are two categories of constraint definitions: the \emph{Declarative Definitions} and the \emph{Constraint Automata Definitions}. Each constraint definition has an associated Constraint Declaration that defines the prototype of the constraint. A declarative definition is defined as a set of constraint instances. For more details, we refer the reader to~\cite{moccmloperbib} that described the declarative part inspired from the \ccsl language. A Constraint Automata Definition gives state based support for the definition of relations. This allows the integrator to define complex communication protocols, \eg the AMBA protocol~\cite{ambabus}.

\begin{lstlisting}[language=moccml,
		caption={Facilities Library in \moccml},
		label={lst:moccmllib}, 
		basicstyle=\scriptsize\ttfamily, backgroundcolor=\color{LGrey}, numbers=left, xleftmargin=2pt]
		AutomataConstraintLibrary Facilities{ 
		import "platform:/plugin/fr.inria.aoste.timesquare.ccslkernel.model/ccsllibrary/kernel.ccslLib" as kernel;
		import "platform:/plugin/fr.inria.aoste.timesquare.ccslkernel.model/ccsllibrary/CCSL.ccslLib" as CCSLLib;
		RelationLibrary CCSLBasedBCOoLRelations {
		RelationDefinition RendezVouswithGlobalClockDef[RendezVouswithGlobalClock]{ 
			Expression sampledActionExecuting = SampledOn (Sampled -> globalClock, Trigger-> ActionExecuting)
			Expression sampledOccurs = SampledOn (Sampled -> globalClock, Trigger-> FSMEventTriggering)
			Relation RendezVousSamples[Coincides](Clock2-> sampledActionExecuting , Clock1->FSMEventTriggering)
		}
		RelationDeclaration RendezVouswithGlobalClock (ActionExecuting: clock , FSMEventTriggering: clock, globalClock: clock)
		}
		}
\end{lstlisting}

Listing~\ref{lst:moccmllib} shows a partial representation of the \moccml library \emph{facilities.moccmllib} that provides all the declarations used in the previous examples. Lines 2 and 3 imports \ccsl libraries that contains the declaration of the kernel relations and expression from \ccsl. 

However, an integrator may need to extend the current library to define new specific constraints depending on its problems and domain. To illustrate this, we propose to rewrite the coordination rule presented in Listing~\ref{lst:bcoolrunningexampletimed} by using the library. To do so, we use \moccml to define a new event relation named \emph{RendezvousWithGlobalClock} (Listing~\ref{lst:moccmllib}: line 10) that accepts three events as parameter: \emph{ActionExecuting}, \emph{FSMEventTriggering} and \emph{globalClock}. Roughly speaking, the relation synchronizes the events ActionExecuting and FSMEventTriggering by relying on the ticking of globalClock. Then, the coordination rule can be rewritten as shown in Listing~\ref{lst:bcoolrunningexamplellib}. The order of the parameters corresponds with the order of the parameters in the declaration (Listing~\ref{lst:moccmllib}: line 10). 

	\begin{lstlisting}[language=bcool,
	caption={Synchronized product operator between the TFSM and Activity languages by using the library},
	label={lst:bcoolrunningexamplellib}, 
	basicstyle=\scriptsize\ttfamily, backgroundcolor=\color{LGrey}, numbers=left, firstnumber=10, xleftmargin=2pt]
	do: 
	RendezVouswithGlobalClock(ActionExecute, FSMEventOccurs, globalClock)
	end operator
	\end{lstlisting}

By relying on a \moccml library, the application of \bcool operators results in a \ccsl specification. We can use \ccsl tool (\eg TimeSquare\cite{timesquarebib}) to analyze and execute the generated coordination model. In the next section, we further explain how the coordination model is generated by presenting the semantics of \bcool.   

%We could also use another language to build the semantics of coordination rules and then take benefit from other analysis tools. In the following section, we present the semantics of \bcool by showing how the generation of a model of coordination is done from a \bcool specification. 

%Libraries enable integrators to organize all relevant event relations and expressions by modeling domains. This improves the readability of a \bcool specification by gathering domain specific relations, which can be reused in other specification.
	
%Event expressions create a new event from their parameters (\eg building the \textit{Union}, or the \textit{Intersection} of its parameters).%Relations, however, constrain the evolution of events given as actual parameters. 
%By relying on \moccml, the application of \bcool operators generate a coordination specification in \ccsl. We can then use \ccsl tool (TimeSquare~\cite{timesquarebib}) to perform analyze and execute the generated coordination specification. This is further discussed in Section~\ref{sec:validation}.